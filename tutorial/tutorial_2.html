<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Philipp Bach">

<title>Statistical Programming: Problem Set 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="tutorial_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="tutorial_2_files/libs/quarto-html/quarto.js"></script>
<script src="tutorial_2_files/libs/quarto-html/popper.min.js"></script>
<script src="tutorial_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tutorial_2_files/libs/quarto-html/anchor.min.js"></script>
<link href="tutorial_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tutorial_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tutorial_2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tutorial_2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tutorial_2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#note" id="toc-note" class="nav-link active" data-scroll-target="#note">Note</a></li>
  <li><a href="#exercise-1-binomial-distribution-no-programming-required" id="toc-exercise-1-binomial-distribution-no-programming-required" class="nav-link" data-scroll-target="#exercise-1-binomial-distribution-no-programming-required">Exercise 1: Binomial distribution (no programming required)</a></li>
  <li><a href="#exercise-2-normal-distribution" id="toc-exercise-2-normal-distribution" class="nav-link" data-scroll-target="#exercise-2-normal-distribution">Exercise 2: Normal distribution</a></li>
  <li><a href="#exercise-3-hypothesis-testing-i" id="toc-exercise-3-hypothesis-testing-i" class="nav-link" data-scroll-target="#exercise-3-hypothesis-testing-i">Exercise 3: Hypothesis Testing (I)</a></li>
  <li><a href="#exercise-4-hypothesis-testing-ii" id="toc-exercise-4-hypothesis-testing-ii" class="nav-link" data-scroll-target="#exercise-4-hypothesis-testing-ii">Exercise 4: Hypothesis Testing (II)</a></li>
  <li><a href="#exercise-5-bootstrap" id="toc-exercise-5-bootstrap" class="nav-link" data-scroll-target="#exercise-5-bootstrap">Exercise 5: Bootstrap</a></li>
  <li><a href="#exercise-6-limits-of-the-bootstrap-optional" id="toc-exercise-6-limits-of-the-bootstrap-optional" class="nav-link" data-scroll-target="#exercise-6-limits-of-the-bootstrap-optional">Exercise 6: Limits of the Bootstrap (Optional)</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Statistical Programming: Problem Set 2</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Philipp Bach </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Hamburg
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  

</header>

<section id="note" class="level2">
<h2 class="anchored" data-anchor-id="note">Note</h2>
<p>You will very likely find the solution to these exercises online. I, however, strongly encourage you to work on these exercises without doing so. Understanding someone elseâ€™s solution is very different from coming up with your own. Use the lecture notes and try to solve the exercises independently.</p>
</section>
<section id="exercise-1-binomial-distribution-no-programming-required" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-binomial-distribution-no-programming-required">Exercise 1: Binomial distribution (no programming required)</h2>
<ol type="1">
<li><p>Find <span class="math inline">\(80\%\)</span> and <span class="math inline">\(90\%\)</span> asymptotic confidence intervals for the expected value <span class="math inline">\(E[X]\)</span> based on a survey with <span class="math inline">\(n=100\)</span> and <span class="math inline">\(\hat{p}=\frac{1}{n}\sum_{i=1}^n X_i=0.45\)</span>.</p></li>
<li><p>A student wishes to find the proportion of left-handed people. She surveys <span class="math inline">\(100\)</span> fellow students and finds that only <span class="math inline">\(5\)</span> are left-handed. Does a <span class="math inline">\(95\%\)</span> confidence interval contain the value of <span class="math inline">\(p = 0.1\)</span>?</p></li>
<li><p>A survey is taken with <span class="math inline">\(250\)</span> participants, and a <span class="math inline">\(\hat{p}\)</span> of <span class="math inline">\(0.45\)</span>. The same survey is repeated with <span class="math inline">\(1000\)</span> participants and the same <span class="math inline">\(\hat{p}\)</span> value is found. Compare the two <span class="math inline">\(95\%\)</span> confidence intervals. What is the relationship? Is the margin of error for the second one four times smaller?</p></li>
</ol>
<!-- 
### Solution:
1. $$\hat{p}\pm \frac{\hat{\sigma}_n}{\sqrt{n}}q_z(0.90) =  (0.3862436, 0.5137564) $$
and
$$\hat{p}\pm \frac{\hat{\sigma}_n}{\sqrt{n}}q_z(0.95) =  (0.3681696, 0.5318304)$$
with $\hat{\sigma}_n^2 = \hat{p}(1-\hat{p})=0.2475$. We pay for the increased confidence with a bigger interval.

2. We have $\hat{p}=0.05$ this implies the $95\%$ confidence interval
$$\hat{p}\pm \frac{\hat{\sigma}_n}{\sqrt{n}}q_z(0.975) = (0.007283575, 0.092716425)$$
with $\hat{\sigma}_n^2 = \hat{p}(1-\hat{p})=0.0475$.

3. $$\hat{p}\pm \frac{\hat{\sigma}_n}{\sqrt{250}}q_z(0.975) =  (0.3883312, 0.5116688) $$
and
$$\hat{p}\pm \frac{\hat{\sigma}_n}{\sqrt{1000}}q_z(0.975) =  (0.4191656, 0.4808344) $$
with $\hat{\sigma}_n^2 = \hat{p}(1-\hat{p})=0.2475$.
The margin of error is 
$$\frac{\hat{\sigma}_n}{\sqrt{1000}}q_z(0.975)=\frac{1}{\sqrt{4}}\frac{\hat{\sigma}_n}{\sqrt{250}}q_z(0.975)= \frac{1}{2}0.06166883$$
only halved.
If the sample size is increased by a factor $c$ the margin of error is decreased by the coefficient $1/\sqrt{c}$ which explains that at some point the cost of accumulating new samples is not very efficient. -->
</section>
<section id="exercise-2-normal-distribution" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-normal-distribution">Exercise 2: Normal distribution</h2>
<ol type="1">
<li><p>A hard-drive manufacturer would like to ensure that the mean time between failures (MTBF) for its new hard drive is <span class="math inline">\(1\)</span> million hours. A stress test is designed that can simulate the workload at a much faster pace. The testers assume that a test lasting <span class="math inline">\(10\)</span> days correlates with the failure time exceeding the <span class="math inline">\(1\)</span>- million-hour mark. In stress tests of <span class="math inline">\(15\)</span> hard drives they found an average of <span class="math inline">\(9.5\)</span> days, with a standard deviation of <span class="math inline">\(1\)</span> day. Does a <span class="math inline">\(90\%\)</span> confidence level include <span class="math inline">\(10\)</span> days?</p></li>
<li><p>Let <span class="math inline">\(X\sim \mathcal{N}(\mu,\sigma^2)\)</span>. We have seen that <span class="math display">\[\sqrt{n}\frac{\bar{X}_n-\mu}{\sigma}\sim \mathcal{N}(0,1)\]</span> and that by replacing the unknown parameter <span class="math inline">\(\sigma^2\)</span> by <span class="math inline">\(\hat{S}^2=\frac{1}{n-1}\sum_{i=1}^n(X_i-\bar{X}_n)^2\)</span> we obtain <span class="math display">\[Z_n:=\sqrt{n}\frac{\bar{X}_n-\mu}{\hat{S}} \xrightarrow[]{\mathcal{D}} Z\sim \mathcal{N}(0,1).\]</span> Therefore we can construct asymptotic confidence intervals for <span class="math inline">\(\mu\)</span>. This means that the confidence interval satisfies the confidence level when <span class="math inline">\(n\)</span> is â€˜largeâ€™. But what happens when <span class="math inline">\(n\)</span> is â€˜smallâ€™ and what do we mean by â€˜largeâ€™? The distribution of <span class="math inline">\(Z_n\)</span> is called <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(n-1\)</span> degrees of freedom. Compare the densities of the <span class="math inline">\(t\)</span>-distribution and the normal distribution for <span class="math inline">\(n=3,10,25\)</span> and <span class="math inline">\(50\)</span>. What value of <span class="math inline">\(n\)</span> seems â€˜largeâ€™ enough to say that the two distributions are essentially the same? (Hint: You can use <code>scipy.stats.t</code>)</p></li>
<li><p>In the setting of Exercise 2.2 use a simulation to compare the resulting confidence intervals for <span class="math inline">\(\mu=0\)</span> (choose <span class="math inline">\(\sigma^2=5\)</span>) with confidence level <span class="math inline">\(95\%\)</span>. For each <span class="math inline">\(n\)</span> calculate <span class="math inline">\(1000\)</span> independent samples and count how often the true parameter <span class="math inline">\(\mu\)</span> is contained in the confidence interval.<br> <span class="math inline">\(\Big(\)</span>Hint: Remark that <code>np.var()</code> calculates <span class="math inline">\(\frac{1}{n}\sum_{i=1}^n(X_i-\bar{X}_n)^2\)</span>.<span class="math inline">\(\Big)\)</span></p></li>
</ol>
<!-- 
### Solution:
1. $$9.5 \pm \frac{1}{\sqrt{15}}q_z(0.95) =  (9.075301, 9.924699) $$
or one-sided
$$9.5 + \frac{1}{\sqrt{15}}q_z(0.9) =  (-\infty, 9.830895) $$

2. We have -->
<!-- 

3.The confidence intervals are given by -->
</section>
<section id="exercise-3-hypothesis-testing-i" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-hypothesis-testing-i">Exercise 3: Hypothesis Testing (I)</h2>
<p>We start this exercise by loading datasets from Stine. Create a folder â€˜Datasetsâ€™ and save all datasets. You can enter the complete path of the data or change the current working directory to the given path (which then should contain your Datasets folder) by</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">"[INSERT YOUR PATH HERE!]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now load the <code>brain_size</code> dataset. The dataset contains a small sample of observations of features (like gender, weight, height and three different IQ-measures) for different individuals.</p>
<p>At first we calculate some descriptive statistics.</p>
<ol type="1">
<li><p>Calculate the means and standard deviations for VIQ, weight and height.</p></li>
<li><p>Plot the weight as a histogram.</p></li>
<li><p>As a primitive approach to determine whether there are differences based on gender, calculate the means of the features above again conditioned on gender.</p></li>
</ol>
<p>Assume that the VIQ, weight and height are normal distributed.</p>
<ol start="4" type="1">
<li><p>What can you say about the hypothesis that the mean of the VIQ is 100?</p></li>
<li><p>Can you reject the hypothesis that the mean of the VIQ is the same for women and men? Test the same hypothesis for weight and height.</p></li>
<li><p>Is the assumption of the normal distribution of the VIQ justified?</p></li>
<li><p>Is the result for VIQ in 2. still valid if we drop the assumption of normality? (Hint: the wicoxon signed-rank test needs equal sample sizes) Which null hypothesis are we actually testing?</p></li>
<li><p>Can we reject the assumption that males and females have the same distribution of VIQ? Compare two histograms to interpret your result!</p></li>
</ol>
<!-- 
### Solution: -->
</section>
<section id="exercise-4-hypothesis-testing-ii" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4-hypothesis-testing-ii">Exercise 4: Hypothesis Testing (II)</h2>
<p>Now we want to test whether the proportion (probability of success) in a group equals a certain given value.</p>
<ol type="1">
<li><p>Use <code>help(stats.binomtest)</code> to make yourself familiar with the <code>binomtest</code> function.</p></li>
<li><p>A poll taken in <span class="math inline">\(2003\)</span> among <span class="math inline">\(200\)</span> Europeans found that only <span class="math inline">\(16\%\)</span> favored the policies of the United States. Perform a test of significance to see whether this is significantly different from the <span class="math inline">\(50\%\)</span> proportion of Americans in favor of these policies.</p></li>
<li><p>A new drug therapy is tested. Of <span class="math inline">\(50\)</span> patients in the study, <span class="math inline">\(40\)</span> had no recurrence in their illness after <span class="math inline">\(18\)</span> months. With no drug therapy, the expected percentage of no recurrence would have been <span class="math inline">\(75\%\)</span>. Does the data support the hypothesis that this percentage has increased? What is the <span class="math inline">\(p\)</span>-value? Why is usefull to consider a one-sided test?</p></li>
</ol>
<!-- ### Solution: -->
</section>
<section id="exercise-5-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5-bootstrap">Exercise 5: Bootstrap</h2>
<p>Load the <code>lightbulb_lifetime</code> data, which contains a (simulated) sample of lifespans of lightbulbs measured in hours.</p>
<ol type="1">
<li><p>Estimate the median lifetime of a lightbulb. (Hint:you can use <code>.values</code> to convert pandas dataframes into arrays and <code>.flatten()</code> to create vectors from arrays)</p></li>
<li><p>The sample median is an asymptotically normal distributed estimator for the median. Try to estimate the variance of the sample median with bootstrap (Help: Use <code>np.random.choice()</code>, additionally <code>np.empty()</code> could be helpful).</p></li>
<li><p>Show with a simulation that your confidence interval is able to asymptotically satisfy the confidence level. Use standard normal distributed and exponential ( with parameter 0.01) distributed random variables in your simulation. (Help:<code>np.random.normal()</code> and <code>np.random.exponential()</code>)</p></li>
</ol>
<!-- 
### Solution:

Here we have various implementations. 

That's the first variant:  -->
<!-- 
Here's the second variant (working on pandas DataFrames): -->
<!-- Constructing a one-sided confidence interval (here only calculating the lower bound, since the upper bound is $\infty$): -->
</section>
<section id="exercise-6-limits-of-the-bootstrap-optional" class="level2">
<h2 class="anchored" data-anchor-id="exercise-6-limits-of-the-bootstrap-optional">Exercise 6: Limits of the Bootstrap (Optional)</h2>
<ol type="1">
<li><p>Draw <span class="math inline">\(n=50\)</span> observations from a random variable <span class="math inline">\(X\sim Unif[1,5)\)</span> and estimate the upper bound given the sample.</p></li>
<li><p>What happens if you try to estimate a confidence interval with significance level <span class="math inline">\(\alpha=0.05\)</span> for the upper bound with bootstrap quantiles?</p></li>
<li><p>Try to give an heuristic argument why bootstrap does not work in this scenario. (Hint: extreme values)</p></li>
</ol>
<!-- ### Solution: -->
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>